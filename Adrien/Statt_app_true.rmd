---
title: "Statt app"
author: "Adrien Meschberger"
date: '2022-11-01'
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, eval = TRUE}
library(tidyverse)
library(dplyr)
library(kableExtra)
```


## Importer les données : 


```{r cars}
setwd("C:/Users/pc/Desktop/ENSAE_1A/Semestre 3/Stat app/archive (2)")

trans <- read.csv2("credit_card_transactions-ibm_v2.csv", header = TRUE, sep = ",")
setwd("C:/Users/pc/Desktop/ENSAE_1A/Semestre 3/Stat app/archive (2)")
user0 <- read.csv2("User0_credit_card_transactions.csv", header= TRUE, sep = ",")
setwd("C:/Users/pc/Desktop/ENSAE_1A/Semestre 3/Stat app/archive (2)")
users <- read.csv2("sd254_users.csv", header = TRUE, sep = ",")
setwd("C:/Users/pc/Desktop/ENSAE_1A/Semestre 3/Stat app/archive (2)")
cards <- read.csv2("sd254_cards.csv", header = TRUE, sep = ",")

```

## Premier aperçu des données : 

```{r}
head(trans)
head(user0)
head(users)
head(cards)
```


## Nettoyage des données : 

Supprimer les lignes avec que des nan : Il y a que des NaN dans users et trans : Appartement ? Amount de transaction 
Supprimer les $ dans les montants. 
Vérifier que les transactions sont bien des nombres, pas d'erreur. 

```{r}

#trans <- trans %>% drop_na()
#user0 <- user0 %>% drop_na()
#cards <- cards %>% drop_na()

# Supprimer les dollars : 



users$Per.Capita.Income...Zipcode <- substr(users$Per.Capita.Income...Zipcode,2,nchar(users$Per.Capita.Income...Zipcode))

users$Yearly.Income...Person <- substr(users$Yearly.Income...Person,2,nchar(users$Yearly.Income...Person))

users$Total.Debt <- substr(users$Total.Debt,2,nchar(users$Total.Debt)) 

user0$Amount <- substr(user0$Amount,2,nchar(user0$Amount))

cards$Credit.Limit <- substr(cards$Credit.Limit,2,nchar(cards$Credit.Limit))

trans$Amount <- substr(trans$Amount,2,nchar(trans$Amount))

#Transformer les Amount en float 

trans$Amount <- as.numeric(trans$Amount)
users$Per.Capita.Income...Zipcode <- as.numeric(users$Per.Capita.Income...Zipcode)
users$Total.Debt<- as.numeric(users$Total.Debt)
users$Yearly.Income...Person <- as.numeric(users$Yearly.Income...Person)
user0$Amount <- as.numeric(user0$Amount)
cards$Credit.Limit <- as.numeric(cards$Credit.Limit)

str(trans)
str(users)
str(cards)
str(user0)


```
#Description rapide des datasets : 
Nombres d'utilisateur unique. 

```{r}

str(trans) 
str(user0)
str(users)
str(cards)

a <- head(trans)
summary(trans)

```
## Combien de transaction par usager ? 

```{r}
trans %>% group_by(trans$User) %>% summarise(n=n())%>% kable(caption = "Nombre de transactions par usager")%>% scroll_box(width = "100%", height = "200px")



trans %>% group_by(trans$User, trans$Year) %>% summarise(n = n()) %>% kable(caption = "Nombre de transaction par usager par année") %>% scroll_box(width = "100%", height = "200px")



trans %>% group_by(trans$User) %>% summarise(av = mean(trans$Amount)) %>% kable(caption = "montant moyen des transactions de chaque usager")%>% scroll_box(width = "100%", height = "200px")


users %>% group_by(Num.Credit.Cards) %>% summarise(n=n()) %>% kable(caption = "Nombre de cartes de crédit")%>% scroll_box(width = "100%", height = "200px")

hist(users$FICO.Score, breaks = seq(400, 900, 20))

hist(users$Yearly.Income...Person, breaks = seq(0, 350000, 500))

a <- density(users$Yearly.Income...Person, breaks = seq(0, 350000, 200))
plot(a)




```
Variables d’intérêt à créer : 
-	fréquence des transactions. (petites transactions consécutives) 
-	Montant moyen. 
-	Pour un usager, quelle ville. Distance géographique entre chaque transaction. 
-	Temps entre chaque transaction (rapproché ou pas) ?
- Définir des classes de FICO score (système de notation de crédit)
- Trier les agents par tranches de revenu. 
- Regarder en fonction du type de carte possédée. 
- Prendre en compte la géographie des transaction, lieu de résidence de la personne vs. lieu de la transaction. 
- Classifier les agents en fonction du montant de leur transaction. 


Variables à risque éthique : 
- Niveau de revenu, Attention !!!!!  pas d'amalgamme.
- Attention aussi géographie !!! 

Eccueils à éviter : 
- Prendre en compte des variables peu pertinentes, donnerait une sur prédiction des fraudes. 
- Critère trop strict => sous - prédiction. 

```{r}
print("hello")
```


